From 6ed8698b45e3bff2d82f27f9ce69571ea41f9d66 Mon Sep 17 00:00:00 2001
From: Zhihong Yu <tedyu@apache.org>
Date: Sat, 31 Dec 2011 05:02:25 +0000
Subject: [PATCH 067/101] HBASE-5112  TestReplication#queueFailover flaky due to potentially
                uninitialized Scan (Jimmy Xiang)

Reason: Test
Author: Jimmy Xiang
Ref: CDH-4035
---
 .../hadoop/hbase/replication/TestReplication.java  |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java b/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java
index 8976ae4..58ffffd 100644
--- a/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java
+++ b/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java
@@ -567,14 +567,13 @@ public class TestReplication {
       initialCount = res.length;
     }
 
-    Scan scan2 = new Scan();
-
     int lastCount = 0;
 
     for (int i = 0; i < NB_RETRIES; i++) {
       if (i==NB_RETRIES-1) {
         fail("Waited too much time for queueFailover replication");
       }
+      Scan scan2 = new Scan();
       ResultScanner scanner2 = htable2.getScanner(scan2);
       Result[] res2 = scanner2.next(initialCount * 2);
       scanner2.close();
@@ -604,6 +603,7 @@ public class TestReplication {
         }
       }
     };
+    killer.setDaemon(true);
     killer.start();
     return killer;
   }
-- 
1.7.0.4

