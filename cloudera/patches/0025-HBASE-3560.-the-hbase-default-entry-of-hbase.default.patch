From ae64aa9eff953c1a8854416c178576f847018be2 Mon Sep 17 00:00:00 2001
From: Todd Lipcon <todd@cloudera.com>
Date: Mon, 12 Sep 2011 18:58:24 -0700
Subject: [PATCH 025/101] HBASE-3560. the hbase-default entry of "hbase.defaults.for.version" causes tests not to run via not-maven

Reason: ease development on branch
Author: Ryan Rawson
Ref: CDH-3604
---
 .../apache/hadoop/hbase/HBaseConfiguration.java    |    1 +
 src/main/resources/hbase-default.xml               |   13 +++++++++++++
 src/test/resources/hbase-site.xml                  |   13 +++++++++++++
 3 files changed, 27 insertions(+), 0 deletions(-)

diff --git a/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java b/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java
index b2d59ed..55cf55e 100644
--- a/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java
+++ b/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java
@@ -60,6 +60,7 @@ public class HBaseConfiguration extends Configuration {
   }
 
   private static void checkDefaultsVersion(Configuration conf) {
+    if (conf.getBoolean("hbase.defaults.for.version.skip", Boolean.FALSE)) return;
     String defaultsVersion = conf.get("hbase.defaults.for.version");
     String thisVersion = VersionInfo.getVersion();
     if (!thisVersion.equals(defaultsVersion)) {
diff --git a/src/main/resources/hbase-default.xml b/src/main/resources/hbase-default.xml
index 67499ff..82dd25e 100644
--- a/src/main/resources/hbase-default.xml
+++ b/src/main/resources/hbase-default.xml
@@ -651,4 +651,17 @@
     classpath.
     </description>
   </property>
+  <property>
+    <name>hbase.defaults.for.version.skip</name>
+    <value>false</value>
+    <description>
+    Set to true to skip the 'hbase.defaults.for.version' check.
+    Setting this to true can be useful in contexts other than
+    the other side of a maven generation; i.e. running in an
+    ide.  You'll want to set this boolean to true to avoid
+    seeing the RuntimException complaint: "hbase-default.xml file
+    seems to be for and old version of HBase (@@@VERSION@@@), this
+    version is X.X.X-SNAPSHOT"
+    </description>
+  </property>
 </configuration>
diff --git a/src/test/resources/hbase-site.xml b/src/test/resources/hbase-site.xml
index 9c02f9b..e196858 100644
--- a/src/test/resources/hbase-site.xml
+++ b/src/test/resources/hbase-site.xml
@@ -143,4 +143,17 @@
     standalone and pseudo-distributed.
     </description>
   </property>
+  <property>
+    <name>hbase.defaults.for.version.skip</name>
+    <value>true</value>
+    <description>
+    Set to true to skip the 'hbase.defaults.for.version'.
+    Setting this to true can be useful in contexts other than
+    the other side of a maven generation; i.e. running in an
+    ide.  You'll want to set this boolean to true to avoid
+    seeing the RuntimException complaint: "hbase-default.xml file
+    seems to be for and old version of HBase (@@@VERSION@@@), this
+    version is X.X.X-SNAPSHOT"
+    </description>
+  </property>
 </configuration>
-- 
1.7.0.4

