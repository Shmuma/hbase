<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>12.4.&nbsp;Write Ahead Log (WAL)</title><link rel="stylesheet" href="css/freebsd_docbook.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="book.html" title="The Apache HBase Book"><link rel="up" href="architecture.html" title="Chapter&nbsp;12.&nbsp;Architecture"><link rel="prev" href="regions.arch.html" title="12.3.&nbsp;Regions"><link rel="next" href="performance.html" title="Chapter&nbsp;13.&nbsp;Performance Tuning"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">12.4.&nbsp;Write Ahead Log (WAL)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="regions.arch.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;12.&nbsp;Architecture</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="performance.html">Next</a></td></tr></table><hr></div><div class="section" title="12.4.&nbsp;Write Ahead Log (WAL)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wal"></a>12.4.&nbsp;Write Ahead Log (WAL)</h2></div></div></div><div class="section" title="12.4.1.&nbsp;Purpose"><div class="titlepage"><div><div><h3 class="title"><a name="purpose.wal"></a>12.4.1.&nbsp;Purpose</h3></div></div></div><p>Each RegionServer adds updates (Puts, Deletes) to its write-ahead log (WAL)
            first, and then to the <a class="xref" href="regions.arch.html#store.memstore" title="12.3.4.1.&nbsp;MemStore">Section&nbsp;12.3.4.1, &#8220;MemStore&#8221;</a> for the affected <a class="xref" href="regions.arch.html#store" title="12.3.4.&nbsp;Store">Section&nbsp;12.3.4, &#8220;Store&#8221;</a>.  
        This ensures that HBase has durable writes. Without WAL, there is the possibility of data loss in the case of a RegionServer failure 
        before each MemStore is flushed and new StoreFiles are written.  <a class="link" href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/regionserver/wal/HLog.html" target="_top">HLog</a> 
        is the HBase WAL implementation, and there is one HLog instance per RegionServer.
       </p>The WAL is in HDFS in <code class="filename">/hbase/.logs/</code> with subdirectories per region.
       <p>
        For more general information about the concept of write ahead logs, see the Wikipedia
        <a class="link" href="http://en.wikipedia.org/wiki/Write-ahead_logging" target="_top">Write-Ahead Log</a> article.
       </p></div><div class="section" title="12.4.2.&nbsp;WAL Flushing"><div class="titlepage"><div><div><h3 class="title"><a name="wal_flush"></a>12.4.2.&nbsp;WAL Flushing</h3></div></div></div><p>TODO (describe).
          </p></div><div class="section" title="12.4.3.&nbsp;WAL Splitting"><div class="titlepage"><div><div><h3 class="title"><a name="wal_splitting"></a>12.4.3.&nbsp;WAL Splitting</h3></div></div></div><div class="section" title="12.4.3.1.&nbsp;How edits are recovered from a crashed RegionServer"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3296"></a>12.4.3.1.&nbsp;How edits are recovered from a crashed RegionServer</h4></div></div></div><p>When a RegionServer crashes, it will lose its ephemeral lease in
         ZooKeeper...TODO</p></div><div class="section" title="12.4.3.2.&nbsp;hbase.hlog.split.skip.errors"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3301"></a>12.4.3.2.&nbsp;<code class="varname">hbase.hlog.split.skip.errors</code></h4></div></div></div><p>When set to <code class="constant">true</code>, the default, any error
        encountered splitting will be logged, the problematic WAL will be
        moved into the <code class="filename">.corrupt</code> directory under the hbase
        <code class="varname">rootdir</code>, and processing will continue. If set to
        <code class="constant">false</code>, the exception will be propagated and the
        split logged as failed.<sup>[<a name="d0e3319" href="#ftn.d0e3319" class="footnote">19</a>]</sup></p></div><div class="section" title="12.4.3.3.&nbsp;How EOFExceptions are treated when splitting a crashed RegionServers' WALs"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3325"></a>12.4.3.3.&nbsp;How EOFExceptions are treated when splitting a crashed
        RegionServers' WALs</h4></div></div></div><p>If we get an EOF while splitting logs, we proceed with the split
        even when <code class="varname">hbase.hlog.split.skip.errors</code> ==
        <code class="constant">false</code>. An EOF while reading the last log in the
        set of files to split is near-guaranteed since the RegionServer likely
        crashed mid-write of a record. But we'll continue even if we got an
        EOF reading other than the last file in the set.<sup>[<a name="d0e3336" href="#ftn.d0e3336" class="footnote">20</a>]</sup></p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e3319" href="#d0e3319" class="para">19</a>] </sup>See <a class="link" href="https://issues.apache.org/jira/browse/HBASE-2958" target="_top">HBASE-2958
            When hbase.hlog.split.skip.errors is set to false, we fail the
            split but thats it</a>. We need to do more than just fail split
            if this flag is set.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e3336" href="#d0e3336" class="para">20</a>] </sup>For background, see <a class="link" href="https://issues.apache.org/jira/browse/HBASE-2643" target="_top">HBASE-2643
            Figure how to deal with eof splitting logs</a></p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="regions.arch.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="architecture.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="performance.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">12.3.&nbsp;Regions&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="book.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;13.&nbsp;Performance Tuning</td></tr></table></div></body></html>